var EII;(EII=window.EII||{}).core={init:function(){this.$theBody=$("body"),this.$theWindow=$(window),this.$mainContent=$("#wrapper"),this.$coreContent=$("#page"),this.breakpoints={base:480,small:600,medium:900,large:1200,extra_large:1800},this.prevScrollTop=0,this.scrollDirection=null,this.scrollOffset=null,this.addLegacyPlaceholderText(),this.scrollToLinks(),this.addUserAgentHook(),this.$theWindow.scroll(function(e){EII.core.determineScrollDirection(this)})},checkIfCMS:function(){return void 0!==EII.cms&&!0===EII.cms.isCMS},getHeaderOffset:function(){var e=$("#masthead"),t=$(".mini_header_shim")[0],i=$("#masthead_shim");return"hidden"===$(e).css("overflow")?$(t).height()+20:i.height()+20},addUserAgentHook:function(){document.documentElement.setAttribute("data-useragent",navigator.userAgent)},determineScrollDirection:function(e){var t=$(e).scrollTop();t<0&&(t=0),t>this.$theBody.height()-this.$theWindow.height()&&(t=this.$theBody.height()-this.$theWindow.height()),t>=this.prevScrollTop&&t?this.scrollDirection="down":this.scrollDirection="up",this.prevScrollTop=t},elementViewportExtents:function(e){if(e){var t={};return t.elementTop=$(e).offset().top,t.elementBottom=t.elementTop+$(e).outerHeight(),t.viewportTop=$(window).scrollTop(),t.viewportBottom=t.viewportTop+$(window).height(),t}},addLegacyPlaceholderText:function(){$("input, textarea").placeholder()},scrollToLinks:function(){var i=this;$("a.scrollTo").on("click",function(e){var t=$(this).attr("href");0<$(t).length&&(e.preventDefault(),i.scrollToElement(t))})},scrollToElement:function(e){if(0<$(e).length){var t=$(e),i=t.css("margin-top");i=parseFloat(i);var n=t.offset().top-($("#event_top_nav").height()+i);$("html,body").animate({scrollTop:n},800,function(){if(t.attr("id")?location.hash="#"+t.attr("id"):location.hash="",t.focus(),t.is(":focus"))return!1;t.attr("tabindex","-1"),t.focus()})}},announcements:{$announcementArea:null,$currentAnnouncement:null,announcementSelector:".an_announcement",closeSelector:".close_announcement_on_click",asyncURL:"/api/frontendservice/SetPecrAcceptance?ident=",init:function(){0<$("#announcements").length&&(this.$announcementArea=$("#announcements"),this.hideAll(),this.bindDismissTopOfPile(),this.displayTopOfPile(),this.validateNewsletterEmail(),this.popupLegalCompliance.init())},hideAll:function(){this.$announcementArea.find(this.announcementSelector).hide()},displayTopOfPile:function(){var e=this.$announcementArea.find(this.announcementSelector).filter(":first");(this.$currentAnnouncement=e).addClass("is_showing"),e.slideDown("slow",function(){e.attr("style","")})},dismissTopOfPile:function(e){var t=this;this.$currentAnnouncement.data("announceref")&&!1!==e&&this.logDismissal(this.$currentAnnouncement.data("announceref")),this.$currentAnnouncement.fadeOut("slow",function(){t.$currentAnnouncement.remove(),t.$currentAnnouncement=null,t.displayTopOfPile()})},bindDismissTopOfPile:function(){var t=this;this.$announcementArea.find(this.closeSelector).click(function(e){e.preventDefault(),t.dismissTopOfPile()})},logDismissal:function(e){if(e&&this.asyncURL){var t=this.asyncURL+e;$.ajax({type:"GET",url:t,data:null,success:function(e){},error:function(e){}})}},validateNewsletterEmail:function(){var n=this,r=3e4,a="Thank you for signing up!",t="Enter a valid email address",o="#F16128";$("#newsletter-submit").bind("click",function(){var e=$("#newsletter-input"),i=e.val();!function(e){if(250<=e.length)return!1;return/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(e)}(i)?(e.val(""),e.attr("placeholder",t),e.css("border-color",o)):n.popupLegalCompliance.show({onAccept:function(){var e=n.popupLegalCompliance.extractFieldValues();$("#an_announcement_email").val(e.email),$("#an_announcement_telephone").val(e.telephone),$("#an_announcement_sms").val(e.sms),$("#an_announcement_mail").val(e.mail);var t=i;$(".newsletter .actions").fadeOut(),$(".newsletter .expanded_text").text(a),$("#newsletter-submit-hidden").trigger("click"),document.cookie="campaign-monitor = "+t,setTimeout(function(){n.dismissTopOfPile()},r)}});return!1}),$(".close_newsletter").click(function(e){e.preventDefault(),document.cookie="campaign-monitor = closed",n.dismissTopOfPile()})},popupLegalCompliance:{popupId:"#popup_legal_compliance",popupBackdropId:"#popup_legal_compliance_backdrop",formId:"#popup_legal_compliance_form",onAcceptCallback:null,init:function(){var e=this;$("#subForm").submit(function(e){e.preventDefault();var t=$(this)[0],i=$(t).serialize();return $.ajax({type:t.method,url:t.action,data:i,success:function(e,t,i){},error:function(e,t,i){}}),!1}),$("#popup_legal_compliance_submit").click(function(){e.onAcceptCallback(),e.hide()}),$("#popup_legal_compliance_close").click(function(){e.hide()})},hide:function(){$(this.popupId).fadeOut(200),$(this.popupBackdropId).fadeOut(200)},show:function(e){$(this.popupBackdropId).fadeIn(200),$(this.popupId).fadeIn(200),this.onAcceptCallback=e.onAccept},extractFieldValues:function(){var t=$(this.formId);function e(e){return $(e,t)[0].checked?"1":"0"}return{email:e("#popup_legal_compliance_email"),telephone:e("#popup_legal_compliance_telephone"),sms:e("#popup_legal_compliance_sms"),mail:e("#popup_legal_compliance_mail")}}}},overlay:{$currentOverlay:null,$overlayInitiatedBy:null,mainContentFixed:!1,escapeClosesOverlay:!1,setOverlay:function(e,t,i){this.unsetOverlay();var n=!0;!1===i&&(n=!1);var r=$(e).find("a.close_overlay");if(0<r.length)r.on("click",function(e){e.preventDefault(),EII.core.overlay.unsetOverlay()});else{var a=$('<a class="close_overlay removable" href="#" title="close">Close <span class="icon-cancel" aria-hidden="true"></span></a>');a.on("click",function(e){e.preventDefault(),EII.core.overlay.unsetOverlay()}),$(e).append(a)}this.fixMainContent(n),$(e).addClass("overlayed"),$(t).addClass("is_active"),EII.core.$theWindow.scrollTop(0),this.focusOverlay($(e),$(t)),this.$currentOverlay=e,this.bindEscapeToOverlay()},unsetOverlay:function(){null!==this.$currentOverlay&&($(this.$currentOverlay).find("a.close_overlay.removable").remove(),$(this.$currentOverlay).removeClass("overlayed"),this.$currentOverlay=null,this.$overlayInitiatedBy.removeClass("is_active"),this.unfocusOverlay(),this.unfixMainContent())},fixMainContent:function(e){EII.core.scrollOffset=EII.core.$theWindow.scrollTop(),!1===e?EII.core.$mainContent.addClass("fixed_mobile"):EII.core.$mainContent.addClass("fixed"),EII.core.$mainContent.css("top",-1*EII.core.scrollOffset+"px"),this.mainContentFixed=!0},unfixMainContent:function(){EII.core.$mainContent.removeClass("fixed"),EII.core.$mainContent.removeClass("fixed_mobile"),EII.core.$mainContent.css("top","auto"),EII.core.$theWindow.scrollTop(EII.core.scrollOffset),this.mainContentFixed=!1},focusOverlay:function(e,t){var i=e.find("input:not([readonly],[hidden],[disabled]), textarea"),n=e.find("a.close_overlay");0<i.length?i[0].focus():n.focus(),this.$overlayInitiatedBy=t;var r=e.find("a[href]:last, input:not([readonly],[hidden],[disabled]):last, select:not([readonly],[hidden],[disabled]):last, textarea:not([readonly],[hidden],[disabled]):last, button:not([readonly],[hidden],[disabled]):last"),a=r[r.length-1];$(a).on("keydown",function(e){"none"!==n.css("display")&&9===e.keyCode&&(e.shiftKey||(e.preventDefault(),$(n).focus()))}),$(n).on("keydown",function(e){9===e.keyCode&&e.shiftKey&&(e.preventDefault(),$(n).focus())})},unfocusOverlay:function(){null!==this.$overlayInitiatedBy&&(this.$overlayInitiatedBy.focus(),this.$overlayInitiatedBy=null)},bindEscapeToOverlay:function(e){!1===this.escapeClosesOverlay&&(this.escapeClosesOverlay=!0,document.addEventListener("keydown",EII.core.overlay.bindEscapeToOverlay)),null===this.$currentOverlay||!e||e.keyCode&&27!==e.keyCode||EII.core.overlay.unsetOverlay()}},stickies:{stickyWrapSelector:"data-sticky-container",stickyElSelector:"data-sticky",stickyBreakpointSelector:"data-sticky-for",stickyOffsetSelector:"data-margin-top",stickyIsStickyClass:"is_sticking",activeStickies:null,init:function(){0<$("[data-sticky]").length&&(this.$masthead=$("#masthead"),this.$mobileShim=$(".mini_header_shim")[0],this.$desktopShim=$("#masthead_shim"),this.setStickies(),window.addEventListener("resize",function(){EII.core.stickies.updateStickies()}))},setStickies:function(){null!==this.activeStickies&&(this.activeStickies.destroy(),this.activeStickies=null),this.$allStickies=$("["+this.stickyElSelector+"]"),this.activeStickies=new Sticky("["+this.stickyElSelector+"]",{marginTop:EII.core.stickies.getOffset(),stickyClass:EII.core.stickies.stickyIsStickyClass})},getOffset:function(){return EII.core.getHeaderOffset()},updateStickies:function(){null!==this.activeStickies&&this.activeStickies.update()},prepASticky:function(e,t,i){i&&EII.core.breakpoints[i]||(i=0),$(e).attr(EII.core.stickies.stickyWrapSelector,""),$(t).attr(EII.core.stickies.stickyElSelector,"").attr(EII.core.stickies.stickyBreakpointSelector,EII.core.breakpoints[i])}}},(EII=window.EII||{}).plugins={init:function(){this.objectFit._init(),this.lazyLoader._init(),this.textBalancer._init()},lazyLoader:{_init:function(){window.lazzy.run(".img")}},textBalancer:{_init:function(){window.balanceText()},balance:function(){window.balanceText.updateWatched()}},objectFit:{_init:function(){window.objectFitImages()}}},(EII=window.EII||{}).announcement_banner={init:function(){this.activate()},activate:function(){angular.module("announcementApp",["ngCookies"]).directive("ngSurvey",["$cookies",function(u){return function(e,t,i){var n="_",r="true",a=new Date(2030,11,31),o=!1,s=i.ngSurvey,l=$(t).find(".close_announcement_on_click"),c=$(t).find("a");function d(e,t){var i=e+n+s;u.put(i,r,{expires:t})}l.on("click",function(){!0!==o&&d("surveyClosed",void 0)}),c.on("click",function(){o=!0,d("surveyTaken",a),l.click()})}}])}},(EII=window.EII||{}).article={allArticles:[],currentArticle:null,init:function(){$(".article").length&&($(".article").each(function(){EII.article.addAnArticle(this),EII.article.currentArticle=this}),$(EII.article.currentArticle).addClass("is_current"),this.stickies.init(),this.rotatingSideRailAd.init(),this.asyncArticles.init(),this.toggleTitlePosition())},addAnArticle:function(e){e.$articleContent=$(e).find(".main_rail")[0],e.$articleBody=$(e).find(".article_body")[0],$(e).hasClass("article--aggregated")&&(e.$articleBody=e.$articleContent),this.rotatingSideRailAd.setArticleProperties(e),this.stickies.setArticleProperties(e),this.allArticles.push(e),this.asyncArticles.setArticleProperties(e),this.moveInlineTout(e),this.moveInlineAd(e),EII.plugins.textBalancer.balance()},moveInlineAd:function(e){if(!$(e).hasClass("article--aggregated")){var t=$(e).find(".main_rail >.ad")[0],i=$(e).find(".article_body >p")[0];i&&t&&$(t).detach().insertAfter(i)}},moveInlineTout:function(e){var t=$(e).find(".main_rail >.article_tout")[0],i=$(e).find(".article_body")[0],n=$(i).children();if(1<n.length&&t){var r=n.length/2|0;$(t).detach().insertAfter(n[r-1])}$(t).addClass("visible")},toggleTitlePosition:function(){var t=!1,e=$(".article_header--featured_alt")[0],i=$(e).find(".header_top")[0],n=$(i).next(),r=$(e).find(".article--featured_alt_img-shim")[0];function a(){var e=window.innerWidth;!t&&600<e&&e<=900?($(i).insertBefore(r),t=!0):t&&900<e?($(i).insertBefore(n),t=!1):t&&e<600&&($(i).insertBefore(n),t=!1)}$(e).length&&(a(),$(window).resize(function(){a()}))},stickies:{init:function(){this.prepStickies(),this.socialShare.init()},setArticleProperties:function(e){e.$theShare=$(e).find(".social_share")[0],e.$theShareTool=$(e).find(".addthis_wrapper")[0],e.$theShareShim=$(e).find(".social_share_shim")[0]},prepStickies:function(){EII.core.stickies.prepASticky(".article .side_rail",".article .sticky_block","medium"),EII.core.stickies.prepASticky(".article .primary",".article .social_share_inner","medium")},resetStickies:function(){this.prepStickies(),EII.core.stickies.setStickies()},socialShare:{init:function(){this.mobileScrollFix(),$(window).scroll(function(){EII.article.stickies.socialShare.mobileScrollFix()}),$(window).resize(function(){EII.article.stickies.socialShare.mobileScrollFix()})},mobileScrollFix:function(){if(void 0!==EII.article.currentArticle.$theShare){EII.core.getHeaderOffset(),$(window).scrollTop();var e=EII.core.elementViewportExtents(EII.article.currentArticle.$articleBody);e.viewportTop>e.elementTop&&e.viewportBottom<e.elementBottom?($(EII.article.currentArticle.$theShare).addClass("stuck_down_in_article"),$(EII.article.currentArticle.$theShareShim).addClass("active")):($(EII.article.currentArticle.$theShare).removeClass("stuck_down_in_article"),$(EII.article.currentArticle.$theShareShim).removeClass("active"))}}}},getTheLastArticleTitle:function(){var e="";return EII.article.allArticles.length&&(e=EII.article.allArticles[EII.article.allArticles.length-1].articleHeading.trim()),e},asyncArticles:{scrollOffset:150,asyncArray:null,adSeed:0,$mobileHeaderArea:null,$pageTitle:null,stripHtml:function(e){e=e.replaceAll('<br data-owner="balance-text">'," ");var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""},init:function(){this.getAsyncArray()&&(this.$mobileHeaderArea=$("#site_header #mini_header .header_message_area p")[0],this.$pageTitle=$("title")[0],$(window).scroll(function(e){EII.article.asyncArticles.checkForNext(),EII.article.asyncArticles.handleCurrentArticle()}),$(window).resize(function(){EII.article.asyncArticles.handleCurrentArticle()}))},getAsyncArray:function(){if(void 0!==window.globalAsyncArticles&&0<window.globalAsyncArticles.length)return null===this.asyncArray&&(this.asyncArray=window.globalAsyncArticles,$("#page").attr("aria-live","polite").attr("aria-relevant","additions removals")),!0},setArticleProperties:function(e){if(e.permLink||(e.permLink=document.location.href),e.articleTitle||(e.articleTitle=document.title),!e.articleHeading){var t=$(e).find("h1")[0];e.articleHeading=$(t).html()}EII.article.asyncArticles.getAsyncArray()&&EII.article.allArticles.length<=EII.article.asyncArticles.asyncArray.length&&(e.asyncProps=EII.article.asyncArticles.asyncArray[EII.article.allArticles.length-1],e.asyncProps.asyncDone=!1)},checkIfInfinite:function(){return!(!EII.article.allArticles[EII.article.allArticles.length-1].asyncProps||!EII.article.allArticles[EII.article.allArticles.length-1].asyncProps.url||!1!==EII.article.allArticles[EII.article.allArticles.length-1].asyncProps.asyncDone)},handleCurrentArticle:function(){var e=null,t=EII.core.elementViewportExtents(EII.article.currentArticle);"down"===EII.core.scrollDirection&&t.elementBottom<t.viewportBottom?e=$(EII.article.currentArticle).next(".article"):"up"===EII.core.scrollDirection&&t.elementTop>t.viewportTop&&(e=$(EII.article.currentArticle).prev(".article")),null!==e&&0<e.length&&($(EII.article.currentArticle).removeClass("is_current"),EII.article.currentArticle=e[0],$(EII.article.currentArticle).addClass("is_current"),history.pushState&&history.pushState(null,EII.article.currentArticle.articleTitle,EII.article.currentArticle.permLink),null!==EII.article.asyncArticles.$mobileHeaderArea&&$(EII.article.asyncArticles.$mobileHeaderArea).html(this.stripHtml(EII.article.currentArticle.articleHeading)),null!==EII.article.asyncArticles.$pageTitle&&$(EII.article.asyncArticles.$pageTitle).html(EII.article.currentArticle.articleTitle),"undefined"!=typeof addthis&&(addthis.update("share","title",EII.article.currentArticle.articleTitle),addthis.update("share","url",EII.article.currentArticle.permLin)))},checkForNext:function(){if(EII.article.asyncArticles.checkIfInfinite()){var e=EII.article.allArticles[EII.article.allArticles.length-1],t=EII.core.elementViewportExtents(e);t.viewportBottom>=t.elementBottom-EII.article.asyncArticles.scrollOffset&&EII.article.asyncArticles.getAsync(e)}},newAdID:function(e){return this.adSeed=this.adSeed+1,e+"_"+this.adSeed},getAsync:function(n){n&&EII.article.asyncArticles.checkIfInfinite()&&(n.asyncProps.asyncDone=!0,$.get(n.asyncProps.url,function(e){var t=$(e).find(".article")[0];if(t){$(t).find(".ad").each(function(){if($(this)[0].hasAttribute("data-slot-variable-name")){var e=$(this).attr("data-slot-variable-name").replace("slot",""),t=EII.article.asyncArticles.newAdID(e);$.each(this.attributes,function(){this.value=this.value.replace(e,t)});var i=$(this).html();i=i.split(e).join(t),$(this).html(i)}});var i=$(e).filter("title").text();t.articleTitle=i,EII.article.asyncArticles.insert(n,t)}},"html"))},insert:function(e,t){if(e&&t){var i;$(t).insertAfter(e).fadeOut(0).fadeIn(),EII.article.addAnArticle(t),EII.article.stickies.resetStickies(),i=EII.article.getTheLastArticleTitle(),t.permLink=e.asyncProps.url,$(t).find(".video_player video").each(function(){bc(this)}),"undefined"!=typeof dataLayer&&dataLayer.push({event:"VirtualPageview",virtualPageURL:t.permLink,virtualPageTitle:i})}}},rotatingSideRailAd:{headerHeight:null,$theWindow:$(window),scrollThresholds:[10,30,60],init:function(){window.globalScrollThresholds&&(this.scrollThresholds=window.globalScrollThresholds),$(window).scroll(function(e){EII.article.rotatingSideRailAd.do()})},setArticleProperties:function(e){e.$theStickyBlock=$(e).find(".side_rail .sticky_block")[0],e.$slotToRotate=$(e).find(".side_rail .ad")[0]},do:function(){var i=this;EII.article.currentArticle.$slotToRotate&&$(i.$theWindow).width()>=EII.core.breakpoints.medium&&$(EII.article.currentArticle.$articleContent).height()>=2*$(i.$theWindow).height()&&$(EII.article.currentArticle.$theStickyBlock).hasClass(EII.core.stickies.stickyIsStickyClass)&&(EII.article.currentArticle.percentScrolled=i.getPercentagePastTopOfPage(EII.article.currentArticle),$(i.scrollThresholds).each(function(e,t){0<EII.article.currentArticle.percentScrolled&&EII.article.currentArticle.percentScrolled>=t&&(i.scrollThresholds.length-1===e||EII.article.currentArticle.percentScrolled<i.scrollThresholds[e+1])&&EII.article.currentArticle.percentCurrent!==t&&(EII.article.currentArticle.percentCurrent=t,EII.ad.refreshASlot(EII.article.currentArticle.$slotToRotate))}))},getPercentagePastTopOfPage:function(e){this.headerHeight=EII.core.getHeaderOffset();var t=$(window).scrollTop(),i=$(e.$articleContent).offset().top-this.headerHeight,n=$(e.$articleContent).height(),r=parseInt(100*(t-i)/n);return r<0?r=0:100<r&&(r=100),r}}},(EII=window.EII||{}).confirmTerms={init:function(){0<$('#confirm_terms [name="acceptedContracts"]').length&&EII.core.overlay.setOverlay($("#confirm_terms")),EnableSubmit=function(e){!0===function(){for(var e=!0,t=$('[name="acceptedContracts"]'),i=0;t[i];++i)if(!1===t[i].checked){e=!1;break}return e}()?$("#proceed").attr("disabled",!1):$("#proceed").attr("disabled",!0)}}},(EII=window.EII||{}).filter={init:function(){this.filterInit()},filterInit:function(){var i;void 0!==$(".filter-results")&&void 0!==(i=$(".filter-form").data("settings"))?angular.module("filterApp",[]).controller("filterController",["$scope","$compile",function(d,u){var t=$(".filter_item"),e=$(".filter_group"),h=Object.keys(i);if(d.categoryFilters=i.category,i.optionselects){d.options=d.options||{},Object.keys(i.optionselects).forEach(function(e){h.push(e),d.options[e]=i.optionselects[e]});["optionselects","options"].forEach(function(e){var t=h.indexOf(e);-1<t&&h.splice(t,1)})}d.getCount=function(){return $(t).parent().filter(":visible").length},d.clearForm=function(){$("input",e).val(""),$("select",e).val($("select option:first",e).val()),h.forEach(function(e){var t="selected"+e.charAt(0).toUpperCase()+e.slice(1);d.options&&d.options[e]&&-1<d.options[e].indexOf("All")?d[t]="All":d[t]=""}),d.selectedCategory="all",t.each(function(){$(this).parent().show();for(var e=$(this).data(),t=Object.keys(e),i=0;i<t.length;i++)-1<t[i].indexOf("Hidden")&&$(this).removeAttr("data-"+t[i].replace(/([A-Z])/g,"-$1").toLowerCase())})},d.dateLoad=function(){$("#datepicker").datepicker(),h.push("pubdate")},d.selectFilter=function(i){var n=i.replace("selected","").toLowerCase(),r=jQuery.grep(h,function(e){return e!=n});t.each(function(){for(var e=[],t=0;t<r.length;t++)e.push($(this).attr("data-"+r[t]+"-hidden"));"all"===d[i]||"All"===d[i]?($(this).removeAttr("data-"+n+"-hidden"),-1===e.indexOf("true")&&($(this).parent().show(),$(this).removeAttr("data-"+n+"-hidden"))):$(this).data(n)!==d[i]?($(this).parent().hide(),$(this).attr("data-"+n+"-hidden","true")):-1===e.indexOf("true")&&($(this).parent().show(),$(this).removeAttr("data-"+n+"-hidden"))})},d.inputFilter=function(o){var s=o.replace("selected","").toLowerCase(),l=$(".typeahead-"+s),c=jQuery.grep(h,function(e){return e!=s});t.each(function(){var t=$(this).data(s).toLowerCase(),e=d[o].toLowerCase(),i=[];l.css("visibility","visible");for(var n=0;n<c.length;n++)i.push($(this).attr("data-"+c[n]+"-hidden"));if(""===e||-1!==t.indexOf(e)){if($(this).removeAttr("data-"+s+"-hidden"),-1===i.indexOf("true")&&$(this).parent().show(),$("a:contains("+t+")",l).length<=0){var r=encodeURI(t),a=$('<li><a href="#" \t\t\t\t\t\t\t\tng-click="typeaheadSet(\''+o+"', '"+t+"'); $event.preventDefault()\" \t\t\t\t\t\t\t\tdata-value="+r+">"+t+"</a></li>").appendTo(l);u(a)(d),l.show()}""===e&&(l.hide(),l.html(""))}else-1===t.indexOf(e)&&($(this).attr("data-"+s+"-hidden","true"),$(this).parent().hide(),0<$("a:contains("+t+")",l).length&&$("a",l).filter(function(){var e=encodeURI(t);return $(this).data("value")===e}).parent().remove(),$("li",l).length<=0&&l.hide())}),$("body").on("click",function(){l.css("visibility","hidden")}),$(".input_wrap input").keydown(function(e){40===e.which&&(e.preventDefault(),$(this).next().find("li a").first().focus())}),$(".typeahead a").keydown(function(e){40===e.which?(e.preventDefault(),$(this).parents("li").next().children("a").first().focus()):38===e.which&&(e.preventDefault(),0===$(this,".typeahead li").parent().index()?$(this).parents("ul").prev().focus():$(this).parents("li").prev().children("a").first().focus())})},d.dateFilter=function(e){var n=e.replace("selected","").toLowerCase(),r=($(".typeahead-"+n),Date.parse(d[e])),a=jQuery.grep(h,function(e){return e!=n});t.each(function(){for(var e=[],t=Date.parse($(this).data("pubdate")),i=0;i<a.length;i++)e.push($(this).attr("data-"+a[i]+"-hidden"));r<t?($(this).parent().hide(),$(this).attr("data-"+n+"-hidden","true")):-1===e.indexOf("true")&&($(this).parent().show(),$(this).removeAttr("data-"+n+"-hidden"))})},d.typeaheadSet=function(e,t){d[e]=t,d.inputFilter(e)}}]):angular.module("filterApp",[])}},(EII=window.EII||{}).iframeGoldrush={init:function(){$("iframe[id*='iframe-goldrush-']").css("display","block")}},(EII=window.EII||{}).myAccount={init:function(){jQuery.validator.setDefaults({onfocusout:function(e){this.element(e)},onkeyup:!1,highlight:function(e){jQuery(e).closest(".form-control").removeClass("is-valid").addClass("is-invalid")},unhighlight:function(e){jQuery(e).closest(".form-control").removeClass("is-invalid").addClass("is-valid")},errorElement:"div",errorClass:"invalid-feedback",errorPlacement:function(e,t){t.parent(".input-group-prepend").length?$(t).siblings(".invalid-feedback").append(e):e.insertAfter(t)}});var e=$("#myaccount_form");if(e){var i=function(){return $("select#AccountData_UserData_Address_Country option:checked").val()},n="115",r="102";jQuery.validator.addMethod("checkZip",function(e,t){switch(i()){case n:return/^\d{5}([ -]?\d{4})?$/i.test(e);case r:return/^[A-CEGHJ-NPRSTVXYa-ceghj-nprstvxy]{1}\d{1}[A-CEGHJ-NPRSTV-Za-ceghj-nprstv-z]{1} *\d{1}[A-CEGHJ-NPRSTV-Za-ceghj-nprstv-z]{1}\d{1}$/i.test(e);default:return!0}},"Enter valid Zip Code"),jQuery.validator.addMethod("checkState",function(e,t){switch(i()){case n:case r:return!!e;default:return!0}},"Enter valid State"),$(e).validate({debug:!1,rules:{"AccountData.UserData.Address.ZipCode":{required:!0,checkZip:!0},"AccountData.UserData.Address.State":{checkState:!0}},errorPlacement:function(e,t){var i=t.attr("id"),n=$("#"+i+"_validate");$(n).length?$(n).html(e.html()):e.insertAfter(t)},success:function(e){e.remove()}})}}},(EII=window.EII||{}).randr={init:function(){this.uiGrid()},uiGrid:function(){var e,t,u;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),void 0!==(t=$(".grid-holder"))&&void 0!==(u=t.data("settings"))?((e=angular.module("rrApp",["ui.grid","ui.grid.pagination","ui.grid.autoResize","odata.ui.grid","ui.grid.treeView","ui.grid.resizeColumns","ngCookies","ngSanitize"])).config(["$httpProvider","$qProvider",function(e,t){e.interceptors.push("AuthorizationInterceptor")}]),e.factory("cookieService",["$cookies",function(n){var e={getTokenChunks:function(){for(var e,t=[],i=1;void 0!==(e=n.get("AccessToken-"+i));)t.push(e),i++;return t}};return e}]),e.factory("AuthorizationInterceptor",["cookieService",function(e){var t=u.tokenChunks||e.getTokenChunks(),i=u.anonymousUserAccessToken;return 0<t.length&&(i=t.join("")),{request:function(e){return i&&e.url&&e.url.startsWith(u.url)&&(e.headers.Authorization="Bearer "+i),e}}}]),e.controller("rankingsController",["$scope","$http","$odataresource","uiGridConstants",function(i,e,t,n){var r=0,a=25,o=a;i.columns=[];var s="children",l={9999:"--"},c=function(e,n){var r=[];return angular.forEach(e,function(e,t){e.$$treeLevel=n,r.push(e);var i=e[s];i&&(r=r.concat(c(i,n+1)))}),r};i.odataV4Options={debounceDelay:1e3,expand:[s],resource:t(u.url,{},{odata:{method:"GET",isArray:!0,interceptor:{response:function(e){return t=e.resource,i=c(t,0),t.splice(0,t.length),t.push.apply(t,i),t;var t,i}}}},{isodatav4:!0})},i.list=[];var d=0;angular.forEach(u.columns,function(t,e){var i=u.categories.filter(function(e){return e.name===t.category});if(i&&0<i.length){var n=i[0],r=u.columns.filter(function(e){return e.category===n.name}),a=n.width/r.length;a<70&&(a=70),n.width<=70&&(t.cellClass="grid-center"),t.width=a,d+=a}}),i.isStretched=d<=870,angular.forEach(u.columns,function(e,t){e.cellTemplate='<div class="ui-grid-cell-contents" ng-bind-html="grid.appScope.getValue(row, col)"></div>',i.isStretched&&(e.width=Math.round(e.width/d*100)+"%")}),i.getValue=function(e,t){var i=e.entity[t.field],n=l[i];return void 0!==n?n:i},i.gridOptions={data:"list",columnVirtualizationThreshold:100,rowHeight:40,paginationPageSizes:a,paginationPageSize:a,enableFiltering:!0,enableSorting:!0,categories:u.categories,showTreeExpandNoChildren:!1,headerTemplate:'<div role="rowgroup" class="ui-grid-header"> <div class="ui-grid-top-panel"> <div class="ui-grid-header-viewport"> <div class="ui-grid-header-canvas"> <div class="ui-grid-header-cell-wrapper" ng-style="colContainer.headerCellWrapperStyle()"> <div role="row" class="ui-grid-header-cell-row"> <div class="ui-grid-header-cell ui-grid-clearfix" style="width: 1px; text-align: center;border-right: 0px;box-shadow: -1px 1px #d4d4d4" ng-repeat="cat in grid.options.categories" ng-if="cat.visible && (colContainer.renderedColumns | filter:{ colDef:{category: cat.name} }:true).length > 0"> <span ng-if="cat.showCategoryName === true"> {{cat.displayName}}</span><p ng-if="cat.showCategoryName !== true"></p><div class="ui-grid-header-cell ui-grid-clearfix" ng-repeat="col in colContainer.renderedColumns | filter:{ colDef:{category: cat.name} }:true" ui-grid-header-cell col="col" render-index="$index"> </div></div>\x3c!--!cat.visible && --\x3e<div class="ui-grid-header-cell ui-grid-clearfix" ng-if="col.colDef.category === undefined" ng-repeat="col in colContainer.renderedColumns track by col.uid" ui-grid-header-cell col="col" render-index="$index"></div></div></div></div></div></div></div>',columnDefs:u.columns,onRegisterApi:function(t){(i.gridApi=t).grid.registerRowsProcessor(function(e){return t.grid.columns.forEach(function(e){e.sort&&void 0===e.sort.direction&&(e.sort={})}),e},61),t.treeBase.on.rowExpanded(i,function(e){a+=t.treeBase.getRowChildren(e).length}),t.treeBase.on.rowCollapsed(i,function(e){a-=t.treeBase.getRowChildren(e).length}),t.pagination.on.paginationChanged(i,function(){a=o})}},i.getTableHeight=function(){var e=130;return r=i.gridApi.grid.getVisibleRows().length,$(window).width()<500&&(e+=20),40*r+e+100+"px"},i.getGridStyle=function(){var e={overflow:"hidden"};return i.isStretched&&$(window).width()<=900&&(e["overflow-x"]="scroll",e["overflow-y"]="hidden"),e},i.getStyle=function(){var e={height:i.getTableHeight()};return i.isStretched||(e["overflow-x"]="scroll",e["overflow-y"]="hidden"),e}}])):e=angular.module("rrApp",[])}},(EII=window.EII||{}).searchResults={init:function(){$(".search_results").length&&(this.$theWindow=EII.core.$theWindow,this.overlayFacets())},overlayFacets:function(){$(".search_results .filter-toggle").on("click",function(e){e.preventDefault(),EII.core.overlay.setOverlay($("#search_filtering"),this,!1)})}},(EII=window.EII||{}).siteFooter={init:function(){0<$("#site_footer").length&&(this.$theFooter=$("#site_footer"),this.setCollapsableFooters())},setCollapsableFooters:function(){function t(e,t){var i=t.hasClass("expanded");e.preventDefault(),$(".expanded").each(function(){$(this).removeClass("expanded")}),!0===i?t.removeClass("expanded"):t.addClass("expanded")}$(".collapsable_list_mobile .footer_item_toggle").click(function(e){t(e,$(this).next())}),$(".collapsable_list_mobile .footer_item_toggle").prev().click(function(e){t(e,$(this).next().next())})}},(EII=window.EII||{}).siteHeader={init:function(){0<$("#site_header").length&&(this.$theHeader=$("#site_header"),this.$theMiniNav=$("#mini_header"),this.$theMiniNavShim=$(".mini_header_shim"),this.$theMasthead=$("#masthead"),this.$theMastheadShim=$("#masthead_shim"),this.$navToggle=$("#mini_header .nav_toggle"),this.bindStickyHeaders(),this.bindMobileNavToggle(),this.searchToggle())},bindStickyHeaders:function(){EII.core.checkIfCMS()||($(this.$theMiniNav).addClass("fixed"),$(this.$theMasthead).addClass("fixed"),this.adjustHeaderShims(),$(window).resize(function(){EII.siteHeader.adjustHeaderShims()}))},adjustHeaderShims:function(){$(this.$theMiniNavShim).height($(this.$theMiniNav).outerHeight()),$(this.$theMastheadShim).height($(this.$theMasthead).outerHeight())},bindMobileNavToggle:function(){if(this.$theMasthead.length&&this.$navToggle.length){var t=this;this.$navToggle.on("click",function(e){e.preventDefault(),$(this).hasClass("is_active")?(EII.core.overlay.unsetOverlay(),$("body").removeClass("nav_expanded")):(EII.core.overlay.setOverlay(t.$theMasthead,this,!1),$("body").addClass("nav_expanded"))}),$(this.$theMiniNav).addClass("nav_enabled")}},searchToggle:function(){var t=$(".search_area");$(".search_toggle").on("click",function(e){e.preventDefault(),t[0].classList.add("active")})}},(EII=window.EII||{}).userDetailsPopUp={init:function(){$(function(){if(!Cookies.get("user-details-popup")){$("#download_sitecore").on("click",function(e){e.preventDefault(),$("#download_sitecore_popup").modal()});var i=$("#user-details-form"),n=$("#error-message");n.hide(),jQuery.validator.setDefaults({onfocusout:function(e){this.element(e)},onkeyup:!1,highlight:function(e){jQuery(e).closest(".form-control").removeClass("is-valid").addClass("is-invalid")},unhighlight:function(e){jQuery(e).closest(".form-control").removeClass("is-invalid").addClass("is-valid")},errorElement:"div",errorClass:"invalid-feedback",errorPlacement:function(e,t){t.parent(".input-group-prepend").length?$(t).siblings(".invalid-feedback").append(e):e.insertAfter(t)}}),i&&$(i).validate({debug:!1,errorPlacement:function(e,t){var i=t.attr("id"),n=$("#"+i+"_validate");$(n).length?$(n).html(e.html()):e.insertAfter(t)},success:function(e){e.remove()},submitHandler:function(e,t){return t.preventDefault(),n.hide(),n.empty(),$("#actionUrl").val($("#download_sitecore")[0].attributes.href.nodeValue),$.ajax({url:"/UserDetails/Save",type:"POST",data:i.serialize(),success:function(e){e.IsSuccess?($("#download_sitecore_popup").modal("toggle"),window.location.href=e.Data.ActionUrl):(n.text(e.Message),n.show())}}),!1}})}})}},(EII=window.EII||{}).articleNavigation={init:function(){this.navbar=$(".article_navigation"),this.innerTitle=$("h3",this.navbar),this.scrollTriggers=$(".scroll_trigger",this.navbar),this.scrollTriggerPrev=$(".scroll_prev",this.navbar)[0],this.scrollTriggerNext=$(".scroll_next",this.navbar)[0],this.scrollArea=$(".nav_scroll",this.navbar),this.innerList=$("ul",this.navbar),this.listItems=$("li",this.navbar),this.listItemsTotalWidth=null,this.articles=$(".aggregated_item"),this.offset=155,this.setStickyOffset(),this.scrollButtonAnimate(),this.scrollToArticle(),this.triggerHighlight(),$(window).resize(function(){EII.articleNavigation.getNavItemsWidth(),EII.articleNavigation.manageToggleState(),EII.articleNavigation.setStickyOffset()})},setStickyOffset:function(){var e=$("#masthead"),t=$("#mini_header");"hidden"===$(e).css("overflow")?currentHeaderHeight=$(t).outerHeight():currentHeaderHeight=$(e).outerHeight(),this.navbar.css("top",currentHeaderHeight)},scrollButtonAnimate:function(){var n=this.scrollArea;this.getNavItemsWidth(),this.manageToggleState(),n.scroll(function(){EII.articleNavigation.manageToggleState()}),this.scrollTriggers.click(function(e){e.preventDefault();var t=$(n).scrollLeft(),i=t+200;$(this).hasClass("scroll_prev")&&(i=t-200),n.animate({scrollLeft:i},500)})},getNavItemsWidth:function(){var e=this.listItems,t=0;e.each(function(){t+=$(this).outerWidth(!0)}),this.listItemsTotalWidth=t},manageToggleState:function(){var e=this.scrollArea,t=e.scrollLeft(),i=e.outerWidth()+t+20;null===EII.articleNavigation.listItemsTotalWidth&&EII.articleNavigation.getNavItemsWidth(),0===t?$(EII.articleNavigation.scrollTriggerPrev).attr("disabled",!0):$(EII.articleNavigation.scrollTriggerPrev).attr("disabled",!1),i>=EII.articleNavigation.listItemsTotalWidth?$(EII.articleNavigation.scrollTriggerNext).attr("disabled",!0):$(EII.articleNavigation.scrollTriggerNext).attr("disabled",!1)},scrollToArticle:function(){var i=this.offset;this.listItems.each(function(){$("a",this).click(function(e){e.preventDefault();var t=$(this).attr("href");$("html, body").animate({scrollTop:$(t).offset().top-i},1e3)})})},triggerHighlight:function(){var i,e=this.articles,t=$("a",this.listItems),n=(this.innerList,this.scrollArea),r=this.offset+10,a=(this.innerTitle.outerWidth(!0),!0);$(window).scroll(function(){e.each(function(){var e=$(this).offset().top,t=$(this).outerHeight(!0);$(window).scrollTop()>e-r&&$(window).scrollTop()<e-r+t&&(i="#"+$(this).attr("id"))}),t.each(function(){$(this).removeClass("active").blur(),$(this).attr("href")===i&&($(this).addClass("active"),a&&function(e){e.outerWidth(!0);var t=$(e).position().left,i=$(e).parent().parent().scrollLeft();n.animate({scrollLeft:t+i},1e3),a=!1,setTimeout(function(){a=!0},1e3)}($(this)))})})}},(EII=window.EII||{}).inpageNav={init:function(){0<$(".inpage_nav").length&&(this.prepForSticky(),this.setupOptionMenu())},prepForSticky:function(){EII.core.stickies.prepASticky(".side_rail",".side_rail .inpage_nav","medium")},setupOptionMenu:function(){$(".inpage_nav .option_select").each(function(e){var t=$(this),i=$(t).find(".select_trigger"),n=$(t).find(".select_menu");i.on("click",function(e){e.preventDefault(),n.toggleClass("visible"),"false"===i.attr("aria-expanded")?i.attr("aria-expanded","true"):i.attr("aria-expanded","false")})})}},(EII=window.EII||{}).socialShare={init:function(){0==$(".article").length&&0<$(".social_share").length&&(this.$theShare=$(".social_share")[0],this.$theShareTool=$(".addthis_wrapper")[0],this.$theShareShim=$(this.$theShare).next()[0],this.$theAffector=$(".content .content_area, .randr .main_rail")[0],this.prepForSticky(),this.mobileScrollFix(),$(window).scroll(function(){EII.socialShare.mobileScrollFix()}),$(window).resize(function(){EII.socialShare.mobileScrollFix()}))},prepForSticky:function(){EII.core.stickies.prepASticky(".content .primary",".content .social_share_inner","medium"),EII.core.stickies.prepASticky(".randr .primary",".randr .social_share_inner","medium")},mobileScrollFix:function(){EII.core.getHeaderOffset(),$(window).scrollTop();var e=EII.core.elementViewportExtents(this.$theAffector);e.viewportTop>e.elementTop&&e.viewportBottom<e.elementBottom?($(this.$theShare).addClass("stuck_down"),$(this.$theShareShim).addClass("active")):($(this.$theShare).removeClass("stuck_down"),$(this.$theShareShim).removeClass("active"))}},(EII=window.EII||{}).ad={init:function(){this.lazyLoading.init()},refreshASlot:function(e){var t=$(e).attr("data-slot-variable-name");t&&window[t]&&googletag.cmd.push(function(){googletag.pubads().refresh([window[t]]),EII.ad.lazyLoading.ifLazyFlagAsLoaded(e),EII.core.stickies.updateStickies()})},lazyLoading:{intersectionConfig:{rootMargin:"50px 0px",threshold:.01},lazySlots:null,init:function(){this.lazySlots=$(".ad[data-is-lazy='1']"),"IntersectionObserver"in window?(lazyAdObserver=new IntersectionObserver(EII.ad.lazyLoading.onIntersection,EII.ad.lazyLoading.intersectionConfig),this.lazySlots.each(function(e,t){lazyAdObserver.observe(t)})):this.refreshAllLazy()},onIntersection:function(e){$(e).each(function(e,t){0<t.intersectionRatio&&(lazyAdObserver.unobserve(t.target),EII.ad.refreshASlot(t.target))})},refreshAllLazy:function(){this.lazySlots.each(function(e){EII.ad.refreshASlot(this)})},ifLazyFlagAsLoaded:function(e){"1"===$(e).attr("data-is-lazy")&&$(e).attr("data-lazy-has-loaded","1")},ifLazyCheckHasLoaded:function(e){return"1"!==$(e).attr("data-is-lazy")||"1"===$(e).attr("data-is-lazy")&&"1"===$(e).attr("data-lazy-has-loaded")}}},(EII=window.EII||{}).articleListing={init:function(){EII.core.stickies.prepASticky(".article_listing--top_stories_pullout .items",".article_listing--top_stories_pullout .listing_item:first-child","medium")}},(EII=window.EII||{}).contentArea={init:function(){0<$(".content_area").length&&(this.contentAreaSelector=".content_area",this.manageTables())},manageTables:function(){this.contentTableSelector=this.contentAreaSelector+" table",this.$allTables=$(this.contentTableSelector),this.tableStyles(),this.responsiveTables()},tableStyles:function(){var e;e=(e=(e=e+" , "+this.contentTableSelector)+" , "+this.contentTableSelector+" td")+" , "+this.contentTableSelector+" th",this.stripCommonFormattings(e),this.$allTables.addClass("table")},responsiveTables:function(){$(this.contentTableSelector).each(function(e){var t=$(this);if(t.parent().is("td")||t.parent().is("th"));else{var i="table-responsive-wrapper";t.parent().hasClass("table-responsive")?t.parent().wrap('<div class="'+i+'"></div>'):t.wrap('<div class="'+i+'"><div class="table-responsive"></div></div>'),t.parent().parent().prepend('<p class="overflow_hint pulse" aria-hidden="true">&larr; &rarr;</p>'),t.parent().parent().append('<p class="overflow_hint lower pulse" aria-hidden="true">&larr; &rarr;</p>')}}),this.responsiveTableOverflow(),EII.core.$theWindow.resize(function(){EII.contentArea.responsiveTableOverflow()})},responsiveTableOverflow:function(){EII.contentArea.$allTables.each(function(e){var t=$(this);t.width()>t.parent().width()?t.parent().parent().addClass("overflowing"):t.parent().parent().removeClass("overflowing")})},stripCommonFormattings:function(e){$(e).removeAttr("style width border border-collapse border-spacing cellspacing cellpadding align valign font color bgcolor")}},(EII=window.EII||{}).plugins.init(),$(document).ready(function(){EII.core.init(),EII.siteHeader.init(),EII.siteFooter.init(),EII.contentArea.init(),EII.articleListing.init(),EII.socialShare.init(),EII.article.init(),EII.articleNavigation.init(),EII.inpageNav.init(),EII.core.announcements.init(),EII.confirmTerms.init(),EII.searchResults.init(),EII.myAccount.init(),EII.userDetailsPopUp.init(),EII.randr.init(),EII.filter.init(),EII.announcement_banner.init()}),$(window).on("load",function(){angular.module("app",["rrApp","filterApp","searchApp","announcementApp"]),angular.element(function(){angular.bootstrap(document,["app"])}),EII.ad.init(),EII.core.stickies.init(),EII.iframeGoldrush.init()}),angular.module("searchApp",["ngRoute","ngSanitize","ui.autocomplete"]).constant("Settings",{}).constant("DisplayNames",{categories:"Related Content",persons:"People",publication_id:"Publications"}).constant("PublicationClasses",{publicationId:"css-class"}).constant("PublicationFilters",{}).constant("MyPublications",{}),angular.module("searchApp").controller("CustomWidget",["$scope","ElasticSearch","Settings",function(e,t,i){e.showCustomWidget=i.showCustomWidget,e.$on("RefreshCustomWidget",function(){})}]),angular.module("searchApp").controller("EntitiesWidget",["$scope","ElasticSearch","Settings",function(i,t,e){var r={};function a(e){t.getSemanticData(e.types,e.id,e.validKeywords).then(function(e){var t=e.data;i.errorMessage="",i.semanticEntities=t},function(){i.errorMessage="Service unavailable"}),r.id=e.id,r.id||(r.originalKeywords=e.originalKeywords,r.validKeywords=e.validKeywords)}i.errorMessage="",i.semanticMaxQuantity=e.semanticMaxQuantity,i.$on("RefreshEntitiesWidget",function(e,t){var i,n;(n=t).validKeywords&&r.originalKeywords!==n.originalKeywords?a(t):(i=t,r.id&&r.originalKeywords===i.originalKeywords&&(t.validKeywords=r.validKeywords,a(t)))}),i.semanticValue=function(e,t,i,n,r){var a,o,s;return e&&e[t]?"name"===t?e[t]:0===e[t].length?"":"alias"===t||"industry"===t?e[t].join(", "):"images"===t?"https://www.googleapis.com/freebase/v1/image/"+e.images[0].split(".").join("/")+"?maxwidth="+n+"&maxheight="+r:"description"===t?(a=e.description[0],o=100+300/Math.pow(i,2),a.length>o&&0<(s=a.indexOf(".",o))&&(a=a.substring(0,s+1)),a):e[t][0]:""},i.showEntity=function(e,t){a({types:t,id:e})}}]),angular.module("searchApp").controller("MoreLikeThisWidget",["$scope","$filter","ElasticSearch","Settings",function(r,e,t,i){r.errorMessage="",r.relatedArticles=[];var a=function(e){var t;return null!==(t=/\/([^(article|documents)][0-9a-z]+)(\/?[0-9a-z\-]*)?$/gi.exec(e))?t[1]:null};getMoreLikeThis=function(){ids=["".concat(i.documentsUrl).concat(a(window.location.href))],t.getMoreLikeThis(ids).then(function(e){var t=e.data;r.errorMessage="",angular.forEach(t.hits.hits,function(e,t){var i=0<e.fields.title.length?e.fields.title[0]:"",n=0<e.fields.url_title.length?e.fields.url_title[0]:"";r.relatedArticles.push({url:"https://"+window.location.host+"/article/"+a(e.id)+"/"+n,headline:i})})},function(e){r.errorMessage="Service unavailable"})},getMoreLikeThis()}]),angular.module("searchApp").controller("QuickSearch",["$scope","$rootScope","$location","Suggestion","Settings",function(n,t,i,r,a){n.queryTerm="",n.isSearchPage=function(){return 1===$(".searchContainer").length},n.search=function(){var e=n.queryTerm;n.isSearchPage()?(i.search("page",null),i.search({term:e}),t.$broadcast("RefreshEntitiesWidget",{types:a.semanticTypes,id:void 0,originalKeywords:e})):location=a.searchPageUrl.replace("{KeyWord}",encodeURIComponent(e)),"undefined"!=typeof EM&&EM&&void 0!==EM.core&&EM.core&&EM.core.unsetOverlay()},n.autoSuggest={optionsValues:null,options:{html:!0,minLength:3,delay:500,appendTo:".search_area",source:function(e,i){(a.useElasticSuggester?r.getElasticSuggestions:r.getLocalSuggestions)(e.term).then(function(e){var t=e.data;t.suggester?i($.map(t.suggester,function(e){return e.term})):t.Suggestions&&t.Suggestions.ConceptLabel&&i($.map(t.Suggestions.ConceptLabel,function(e){return e}))},function(){n.errorMessage="Service unavailable"})},select:function(e,t){n.queryTerm=t.item.value,n.search()}}}}]),angular.module("searchApp").controller("Search",["$scope","$rootScope","$location","$filter","Helper","ElasticSearch","Settings","PublicationFilters","MyPublications","Analytics",function(s,l,c,n,d,u,h,p,f,g){var v,m="Relevance";function I(e,t){var i;return""===e?"":(i=$.datepicker.parseDate(h.datePickerFormat,e),t&&i.setHours(23,59,59),n("date")(i,h.dateServiceFormat))}function y(){var e=c.search().filters;return e?angular.fromJson(e):{}}function t(e){return 1==e?null:e}s.loading=!1,s.serverData={},s.showEntities=h.showEntities,s.showPrices=!1,s.page=1,s.queryTerm="",s.didYouMeanCorrected=void 0,s.sortOptions=["Newest","Oldest","Relevance"],s.pages=[],s.errorMessage="",s.dateArticleFormat=h.dateArticleFormat,s.showCustomWidget=h.showCustomWidget,s.pageSize=h.pageSize,s.$on("$locationChangeSuccess",function(){var e=c.search(),t=e.term||"";m=e.sort?e.sort:t?"Relevance":"Newest",s.queryTerm=t,s.didYouMeanCorrected=void 0,s.page=e.page?parseInt(e.page):1,s.pageSize=e.pageSize?parseInt(e.pageSize):h.pageSize,$("#search-site").val(t),function(){var e,t,i,n;s.loading=!0,e=d.fixIfEmpty(c.search().term).trim(),s.didYouMeanCorrected&&(e=s.didYouMeanCorrected);v=e,t=function(e){if($.isEmptyObject(e))return;return $.map(e,function(e,t){return{name:t,options:"dates"!==t||2!==e.length?e:[I(e[0],!1),I(e[1],!0)]}})}(y()),a=c.search().publications,r=a&&a.length?angular.fromJson(a):"NotLoggedIn"===h.subscription?{}:$.map(f,function(e,t){return e?t:null}),i=$.isEmptyObject(r)?void 0:$.map(p,function(e,t){return $.map(e,function(e){return{id:e,filter:-1===r.indexOf(t)}})}),n=s.page>s.pagesCount()?s.pagesCount()-1:s.page-1;var r;var a;var o=s.pageSize;u.getSearchResults(e,m,t,i,n,o).then(function(e){!function(e,t){s.loading=!1,s.errorMessage="",t&&(s.didYouMeanCorrected=t);h.showEntities&&s.$broadcast("RefreshEntitiesWidget",{types:h.semanticTypes,id:void 0,validKeywords:t||v,originalKeywords:v});h.showCustomWidget&&s.$broadcast("RefreshCustomWidget");s.serverData=e,s.showPrices=/pric(ing|e)/i.test(v),s.pages=function(){var e=[],t=s.pagesCount(),i=Math.max(2,s.page-6),n=Math.min(t-1,s.page+6);if(t<=1)return[];1<s.page&&e.push({key:s.page-1,value:"Previous"}),e.push({key:1,value:1}),8<s.page&&e.push({key:-1,value:"..."});for(var r=i;r<=n;r++)e.push({key:r,value:r});return s.page<t-7&&e.push({key:-2,value:"..."}),e.push({key:t,value:t}),s.page<t&&e.push({key:s.page+1,value:"Next"}),e}(),l.$broadcast("RefreshMoreLikeThisWidget",{ids:$.isEmptyObject(s.serverData)?[]:$.map(s.serverData.hits.results,function(e){return e.id})}),l.$broadcast("RefreshFacets",{serverData:s.serverData,filtersFromUrl:y()}),!1!==h.shouldLogAnalytics&&g.logSearch(v,s.resultsCount(),s.page)}(e,e.correctedTerm)},function(){s.errorMessage="Service unavailable",s.loading=!1})}()}),s.useCorrectedTerm=function(){var e=d.hasNestedProperty(s.serverData,["suggester","corrected"])?s.serverData.suggester.corrected:"";s.didYouMeanCorrected=void 0,c.search("page",null),c.search({term:e})},s.changeSortOption=function(e){m===e||s.isSortOptionDisabled(e)||(s.page=1,c.search("sort","Relevance"==e?null:e).search("page",t(s.page)))},s.isSortOptionActive=function(e){return e===m},s.isSortOptionDisabled=function(e){return"Relevance"===e&&""===s.queryTerm},s.resultsCount=function(){return d.hasNestedProperty(s.serverData,["hits","total"])?s.serverData.hits.total:0},s.pagesCount=function(){return 0===s.resultsCount()?1:Math.min(Math.ceil(s.resultsCount()/h.pageSize),100)},s.changePage=function(e){!s.loading&&1<=e&&(c.search("page",t(e)),$("html, body").animate({scrollTop:$(".searchContainer").offset().top},0))}}]),angular.module("searchApp").controller("SearchFacets",["$scope","$location","Helper","Settings","PublicationFilters","MyPublications",function(c,n,d,u,h,p){function r(){var i,n={};return c.facets&&$.each(c.facets,function(e,t){c.hasSelectedOptions(t)&&(i=$.map(t.options,function(e){return e.isSelected?e.term:null}),t.isDateRange&&t.period.isSelected&&(i.push(t.period.dateFrom),i.push(t.period.dateTo)),n[t.group]=i)}),n}function f(e){e.mySelected=0===$.grep(e.options,function(e){return(p[e.term]||!1)!==e.isSelected}).length,e.allSelected=0===$.grep(e.options,function(e){return!e.isSelected}).length}function t(e){var t=$.map(e.options,function(e){return e.isSelected?e.term:null}),i=e.subscriptionsKnown?e.mySelected:e.allSelected;t.length&&(n.search("page",null),n.search("publications",i?null:angular.toJson(t,!1)))}function g(e,t,i){var n=d.hasNestedProperty(e,["hits","facets",t])?e.hits.facets[t][i?"ranges":"terms"]:[];return $.grep(n,function(e){return u.showEmptyRanges||e.count})}function o(e){return(t=e).dates&&2===t.dates.length&&d.canParseDate(t.dates[0])&&d.canParseDate(t.dates[1])?{isSelected:!0,isExpanded:!0,dateFrom:e.dates[0],dateTo:e.dates[1]}:{isSelected:!1,isExpanded:!1,dateFrom:"",dateTo:""};var t}function s(e,t,i){return(o=e.group,s=t,l=i,$.map(s,function(e){var t=!!l[o]&&0<=$.inArray(e.term,l[o]);return{term:e.term,count:e.count,isSelected:t,isHidden:!1}})).concat((r=t,a=i,!(n=e).isDateRange&&a&&a[n.group]?$.map(a[n.group],function(e){return-1===d.indexOfObj(r,"term",e)?{term:e,count:1e3,isSelected:!0,isHidden:!0}:null}):[]));var n,r,a,o,s,l}function i(i,n,r){var e,a=o(n);return function(e,t){if(e.length>t)for(var i=t;i<e.length;i++)c.hasSelectedOptions(e[i])||(e[i].isExpanded=!1)}(e=$.map(u.facets,function(e){return((t=e).isDateRange?v:"publication_id"==t.group?m:l)(i,n,r,e,a);var t}),u.numberOfFacetsExpanded),e}function l(e,t,i,n){var r=g(e,n.group,n.isDateRange),a=d.indexOfObj(c.facets,"group",n.group);return{name:n.name,group:n.group,isDateRange:n.isDateRange,options:s(n,r,t),isExpanded:!(0<a)||c.facets[a].isExpanded,isHidden:0===r.length,useReadMoreDialog:r.length>c.maxOptionsCount}}function v(e,t,i,n,r){var a=l(e,t,0,n);return a.period=r,a}function m(e,t,i,n){var r,a,o=(r=i,a=g(e,"publication_id"),$.map(h,function(t,e){return{term:e,count:$.grep(a,function(e){return-1<$.inArray(parseInt(e.term,10),t)}).reduce(function(e,t){return e+t.count},0),isSelected:$.isEmptyObject(r)?"NotLoggedIn"===u.subscription||p[e]:-1<$.inArray(e,r),isHidden:!1}})),s=d.indexOfObj(c.facets,"group",n.group),l={name:n.name,group:n.group,options:o,isExpanded:!(0<s)||c.facets[s].isExpanded,isHidden:!1,useReadMoreDialog:!1,allSelected:!1,mySelected:!1,subscriptionsKnown:"NotLoggedIn"!==u.subscription};return f(l),l}c.facets=[],c.maxOptionsCount=u.maxOptionsCount,c.readMoreFacetIndex=-1,c.isFilterShown=!0,c.isFiltered=function(){return 0<$.grep(c.facets,function(e){return c.hasSelectedOptions(e)&&"publication_id"!==e.group}).length},c.resetFilterAndApplySearch=function(){n.search("page",null),n.search("filters",null)},c.toggleOption=function(e,i){var t;return c.loading||($.each(e.options,function(e,t){t.term===i&&(t.isSelected=!t.isSelected)}),e.isDateRange&&(e.period.isSelected=!1,e.period.dateFrom="",e.period.dateTo="",$.each(e.options,function(e,t){t.term!==i&&(t.isSelected=!1)})),t=r(),n.search("page",null),n.search("filters",$.isEmptyObject(t)?null:angular.toJson(t,!1))),!1},c.toggleDateValue=function(t,e){var i;return c.loading||(e&&(t.period.dateFrom="",t.period.dateTo=""),t.options.isSelected=!1,t.period.isSelected=""!==t.period.dateFrom||""!==t.period.dateTo,t.period.isSelected&&0<t.options.length&&$.each(t.options,function(e){t.options[e].isSelected=!1}),i=r(),n.search("page",null),n.search("filters",$.isEmptyObject(i)?null:angular.toJson(i,!1))),!1},c.toggleAllPublications=function(i){i.mySelected=!1,$.each(i.options,function(e,t){t.isSelected=i.allSelected}),t(i)},c.toggleMyPublications=function(i){i.allSelected=!1,$.each(i.options,function(e,t){t.isSelected=p[t.term]&&i.mySelected}),t(i)},c.togglePublication=function(e){return f(e),t(e),!1},c.hasSelectedOptions=function(e){return e.isDateRange&&e.period.isSelected||0<$.grep(e.options,function(e){return e.isSelected}).length},c.$on("RefreshFacets",function(e,t){c.facets=i(t.serverData,t.filtersFromUrl,t.publicationsFromUrl)})}]),angular.module("searchApp").directive("ngEnter",function(){return function(t,i,n){i.on("keypress",function(e){13===e.which&&(i.next().focus(),t.$apply(function(){t.$eval(n.ngEnter&&n.ngEnter.trim(),{event:e})}),e.preventDefault())})}}).directive("ngDatePicker",["Settings",function(r){var n=r.datePickerFormat;function a(e,t,i){var n={dateFormat:e,changeMonth:!0,changeYear:!0,yearRange:r.minDatePickerYear+":+0"};return t&&(n.minDate=$.datepicker.parseDate(e,t)),i&&(n.maxDate=$.datepicker.parseDate(e,i)),n}function o(e,t){e.datepicker("destroy"),e.datepicker(t),e.datepicker("refresh")}return{scope:{ngDateMin:"=",ngDateMax:"="},link:function(e,i){e.$watch("ngDateMin",function(e){if(e&&e.trim()){var t=a(n,e&&e.trim(),null);o(i,t)}}),e.$watch("ngDateMax",function(e){if(e&&e.trim()){var t=a(n,null,e&&e.trim());o(i,t)}}),i.datepicker(a(n,null,null))}}}]).directive("ngPreventDefault",function(){return function(e,t){angular.element(t).on("click",function(e){e.preventDefault(),e.stopPropagation()})}}).directive("ngBroadcast",function(){return function(e,t,i){var n=JSON.parse(i.ngBroadcast);e.$broadcast(n.event,n.data)}}).directive("ngToggleOption",function(){return function(e,t,i){t.on("click",function(){e.$apply(function(){return-1!==$(t).parent().attr("class").indexOf("filter-sub")&&(t=$(t).parent()[0]),$(t).hasClass("expandDialog")||$(t).hasClass("expandable")||("dialog-more-options"===$(t).parent().attr("id")&&$("#dialog-more-options").dialog("close"),e.$eval(i.ngToggleOption&&i.ngToggleOption.trim())),!1})})}}).directive("ngOptionsDialogBox",["$filter","Helper",function(r,a){return function(i,n){n.dialog({autoOpen:!1,modal:!0,show:{effect:"fold",duration:500},hide:{effect:"fold",duration:500},buttons:{Cancel:function(){i.readMoreSectionIndex=-1,$(this).dialog("close")}}}),i.$on("OpenDialogBox",function(e,t){i.readMoreFacetIndex=a.indexOfObj(i.facets,"name",t.section),n.dialog({title:"Select "+r("displayName")(t.section)}),n.dialog("open")})}}]).directive("ngTriggerOptionsDialogBox",function(){return function(e,t,i){t.on("click",function(){e.$apply(function(){e.$emit("OpenDialogBox",{section:i.ngTriggerOptionsDialogBox&&i.ngTriggerOptionsDialogBox.trim()})})})}}).directive("ngExpandable",function(){return{restrict:"A",link:function(t,n,i){n.find(".ng-expand-header").first().on("click",function(){t.$apply(function(){var e=t.$eval(i.ngExpandable&&i.ngExpandable.trim());e.isExpanded=!e.isExpanded})}),t.$watch(i.ngExpandable&&i.ngExpandable.trim(),function(e,t){var i=n.find(".ng-expand-body").first();void 0!==e&&(!t||t.isExpanded||e.isExpanded||i.hide(),t&&t.isExpanded!==e.isExpanded&&i.slideToggle("slow"))},!0)}}}),angular.module("searchApp").filter("displayName",["DisplayNames",function(t){return function(e){return t[e]?t[e]:e.charAt(0).toUpperCase()+e.slice(1)}}]).filter("fields",["Helper",function(i){return function(e,t){return i.hasNestedProperty(e,["fields",t])?1<e.fields[t].length?e.fields[t].join(", "):e.fields[t][0]:""}}]).filter("snippet",["Helper",function(i){return function(e,t){return i.hasNestedProperty(e,["snippet",t])?1<e.snippet[t].length?e.snippet[t].join(", "):e.snippet[t][0]:""}}]).filter("removeHtmlTags",function(){return function(e){return $("<span>"+e+"</span>").text()}}).filter("articleHref",["$filter","Settings",function(i,n){return function(e){var t=i("fields")(e,"url_title");return 100<(t=i("removeHtmlTags")(t)).length&&(t=t.substr(0,t.substr(0,100).lastIndexOf("-"))),e.id=e.id.replace(n.documentsUrl,""),"/article/"+(e?e.id:"")+"/"+t}}]).filter("publicationClass",["Helper","PublicationClasses",function(t,i){return function(e){return t.hasNestedProperty(e,["fields","publication_id"])?i[e.fields.publication_id[0]]:""}}]).filter("resultContent",["$filter","Settings",function(i,e){return function(t){return $.map(e.snippetFields,function(e){switch(e){case"recommended":return"<p>"+i("snippet")(t,i("snippet")(t,e))+"</p>";case"standfirst":return"<p>"+i("fields")(t,"description")+"</p>";default:return"<p>"+i("snippet")(t,e)+"</p>"}}).join("")}}]),angular.module("searchApp").factory("Analytics",["$http","$window","Settings",function(n,r,a){return{logSearch:function(e,t,i){n({url:a.analyticsUrl,method:"POST",headers:{"Content-Type":"application/json"},data:angular.toJson({text:e,count:t,page:i})}).then(function(e){var t=e.d||e.data;t&&void 0!==r.euromoney&&r.euromoney&&r.euromoney.googleAnalytics.pushToDataLayer(t)})}}}]),angular.module("searchApp").factory("ElasticSearch",["$q","XDomainRequest","Settings",function(d,u,h){var p,f="/api/Search";function g(e){return e?e.replace(/[~"!.*+\-?^${}()|[\]\\]/g,"\\$&"):e}return{getSearchResults:function i(e,n,r,a,o,t,s){t=t>h.maxPageSize?h.maxPageSize:t;var l=d.defer(),c={site:h.site,term:0===e.length?void 0:g(e),suggester:!s||void 0,facets:r,from:o*t,size:t,subscription:h.subscription};return"Relevance"!==n&&(c.sort="dates",c.sort_order="Oldest"===n?"asc":"desc"),a&&(c.filter_publications_ids=a),u(f,c).then(function(e){var t=e.data;!s&&h.showSuggestionIfNoResults&&t.suggester&&t.suggester.corrected&&0===t.hits.results.length?i(p=t.suggester.corrected,n,r,a,o,!0).then(l.resolve,l.reject):(t.correctedTerm=p,l.resolve(t),p=void 0)}).catch(l.reject),l.promise},getSemanticData:function(e,t,i){var n={site:"semantic",type:e,size:3,from:0,subscription:h.subscription};return t?n.id=[t]:n.term=g(i),u("/api/Semantics",n)},getMoreLikeThis:function(e){var t={site:h.site,id:e,min_term_freq:h.minTermFreq,max_query_terms:h.maxQueryTerms,fields_to_compare:h.fieldsToCompare,fields_to_return:h.fieldsToReturn,size:h.moreLikeThisMaxSize};return u("/api/EuroMoreLikeThis",t)}}}]),angular.module("searchApp").service("Helper",["Settings",function(t){return{canParseDate:function(e){try{$.datepicker.parseDate(t.datePickerFormat,e)}catch(e){return!1}return!0},fixIfEmpty:function(e){return void 0===e?"":e},hasNestedProperty:function e(t,i){var n=i.shift();return void 0===n||!!t.hasOwnProperty(n)&&e(t[n],i)},indexOfObj:function(e,i,n){var r=-1;return e&&0<e.length&&$.each(e,function(e,t){if(t[i]===n)return r=e,!1}),r},objectKeys:function(e){var t=[];if(e!==Object(e))return[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return t}}}]),angular.module("searchApp").factory("Suggestion",["$q","XDomainRequest","Settings",function(e,i,n){var r=n.urlLocalSuggest,a=n.urlElasticSuggest;return{getLocalSuggestions:function(e){var t={SearchTerm:e,MaxResultCount:n.suggesterOptionsCount,CallType:n.suggesterOntologyType};return i(r,t,!0)},getElasticSuggestions:function(e){var t={site:n.site,text:e,size:n.suggesterOptionsCount,subscription:n.subscription};return i(a,t)}}}]),angular.module("searchApp").factory("XDomainRequest",["$window","$http","$q","Settings",function(e,n,t,r){return function(e,t,i){return n({url:(i?"":r.searchApiUrl)+e,method:"POST",headers:{"Content-Type":"application/json"},data:t})}}]);